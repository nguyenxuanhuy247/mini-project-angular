import { DOCUMENT } from '@angular/common';
import { Inject, Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { VTS_THEME_CONFIG } from './tokens';
import * as i0 from "@angular/core";
import * as i1 from "./theme-storage.service";
export const THEME_KEY = 'vts-theme';
export class VtsThemeService {
    constructor(config, document, storage) {
        this.config = config;
        this.document = document;
        this.storage = storage;
        this.theme$ = new BehaviorSubject(null);
        this.allTheme$ = new BehaviorSubject([]);
        this._theme = null;
        this._allTheme = [];
        this.init();
    }
    set theme(value) {
        this._theme = value;
        this.theme$.next(this._theme);
    }
    get theme() {
        return this._theme;
    }
    set allTheme(value) {
        this._allTheme = value;
        this.allTheme$.next(this._allTheme);
    }
    get allTheme() {
        return this._allTheme;
    }
    ngOnDestroy() {
        this.theme$.complete();
        this.allTheme$.complete();
    }
    setTheme(theme) {
        if (this.allTheme.filter(i => i.theme === theme).length) {
            this._theme = theme;
            this.loadTheme();
        }
        else {
            throw new Error(`Unable to find theme ${theme}!`);
        }
    }
    loadTheme() {
        if (!this.document)
            return;
        const url = this._allTheme.filter(i => i.theme === this._theme)?.[0]?.url;
        if (!url)
            throw new Error(`Unable to find theme ${this._theme}!`);
        const script = this.document.createElement('link');
        script.type = 'text/css';
        script.rel = 'stylesheet';
        script.id = `vts-theme-${this._theme}`;
        script.href = `${url}`;
        script.onload = () => {
            // Emit new theme loaded
            this.theme = this._theme;
            this.storage.setObject(THEME_KEY, this._theme);
            this.document.body.setAttribute('vts-theme', this._theme);
            this._allTheme.map(i => i.theme).filter(i => i !== this._theme).forEach((i) => {
                const dom = this.document.getElementById(`vts-theme-${i}`);
                if (dom)
                    dom.remove();
            });
        };
        this.document.body.append(script);
    }
    init() {
        const valid = [];
        const themes = this.config.themes.filter(i => {
            if (valid.includes(i.theme))
                return false;
            if (!!i.url) {
                valid.push(i.theme);
                return true;
            }
            return false;
        });
        if (!themes.length)
            throw new Error("No theme provided or invalid data was provided!");
        this.allTheme = themes;
        const cache = this.storage.getObject(THEME_KEY);
        this._theme = themes.some(i => i.theme === cache) ? cache : (this.config.defaultTheme || themes[0].theme);
        this.loadTheme();
    }
}
VtsThemeService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: VtsThemeService, deps: [{ token: VTS_THEME_CONFIG }, { token: DOCUMENT }, { token: i1.VtsThemeStorageService }], target: i0.ɵɵFactoryTarget.Injectable });
VtsThemeService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: VtsThemeService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: VtsThemeService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [VTS_THEME_CONFIG]
                }] }, { type: Document, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }, { type: i1.VtsThemeStorageService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhlbWUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zZXJ2aWNlcy90aGVtZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUM5RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRXZDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLFVBQVUsQ0FBQzs7O0FBRzVDLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUE7QUFHcEMsTUFBTSxPQUFPLGVBQWU7SUFzQjFCLFlBQ29DLE1BQXNCLEVBQzlCLFFBQWtCLEVBQ3BDLE9BQStCO1FBRkwsV0FBTSxHQUFOLE1BQU0sQ0FBZ0I7UUFDOUIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNwQyxZQUFPLEdBQVAsT0FBTyxDQUF3QjtRQXhCaEMsV0FBTSxHQUFHLElBQUksZUFBZSxDQUFrQixJQUFJLENBQUMsQ0FBQTtRQUNuRCxjQUFTLEdBQUcsSUFBSSxlQUFlLENBQWlCLEVBQUUsQ0FBQyxDQUFBO1FBRXBELFdBQU0sR0FBb0IsSUFBSSxDQUFBO1FBUzlCLGNBQVMsR0FBbUIsRUFBRSxDQUFBO1FBYXBDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUNiLENBQUM7SUF0QkQsSUFBSSxLQUFLLENBQUMsS0FBc0I7UUFDOUIsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUE7UUFDbkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQy9CLENBQUM7SUFDRCxJQUFJLEtBQUs7UUFDUCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUE7SUFDcEIsQ0FBQztJQUdELElBQUksUUFBUSxDQUFDLEtBQXFC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Q0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDM0QsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7Z0JBQ3pCLE9BQU8sS0FBSyxDQUFBO1lBQ2QsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRTtnQkFDWCxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtnQkFDbkIsT0FBTyxJQUFJLENBQUE7YUFDWjtZQUNELE9BQU8sS0FBSyxDQUFBO1FBQ2QsQ0FBQyxDQUFDLENBQUE7UUFDRixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU07WUFDaEIsTUFBTSxJQUFJLEtBQUssQ0FBQyxpREFBaUQsQ0FBQyxDQUFBO1FBQ3BFLElBQUksQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFBO1FBQ3RCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFXLFNBQVMsQ0FBQyxDQUFBO1FBQ3pELElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDekcsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFBO0lBQ2xCLENBQUM7OzRHQXJGVSxlQUFlLGtCQXVCaEIsZ0JBQWdCLGFBQ2hCLFFBQVE7Z0hBeEJQLGVBQWU7MkZBQWYsZUFBZTtrQkFEM0IsVUFBVTs7MEJBd0JOLE1BQU07MkJBQUMsZ0JBQWdCOzswQkFDdkIsTUFBTTsyQkFBQyxRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgVnRzVGhlbWVTdG9yYWdlU2VydmljZSB9IGZyb20gJy4vdGhlbWUtc3RvcmFnZS5zZXJ2aWNlJztcbmltcG9ydCB7IFZUU19USEVNRV9DT05GSUcgfSBmcm9tICcuL3Rva2Vucyc7XG5pbXBvcnQgeyBWdHNUaGVtZSwgVnRzVGhlbWVDb25maWcsIFZ0c1RoZW1lSXRlbSB9IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgY29uc3QgVEhFTUVfS0VZID0gJ3Z0cy10aGVtZSdcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFZ0c1RoZW1lU2VydmljZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIHJlYWRvbmx5IHRoZW1lJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8VnRzVGhlbWUgfCBudWxsPihudWxsKVxuICByZWFkb25seSBhbGxUaGVtZSQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFZ0c1RoZW1lSXRlbVtdPihbXSlcbiBcbiAgcHJpdmF0ZSBfdGhlbWU6IFZ0c1RoZW1lIHwgbnVsbCA9IG51bGxcbiAgc2V0IHRoZW1lKHZhbHVlOiBWdHNUaGVtZSB8IG51bGwpIHtcbiAgICB0aGlzLl90aGVtZSA9IHZhbHVlXG4gICAgdGhpcy50aGVtZSQubmV4dCh0aGlzLl90aGVtZSlcbiAgfVxuICBnZXQgdGhlbWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3RoZW1lXG4gIH1cblxuICBwcml2YXRlIF9hbGxUaGVtZTogVnRzVGhlbWVJdGVtW10gPSBbXVxuICBzZXQgYWxsVGhlbWUodmFsdWU6IFZ0c1RoZW1lSXRlbVtdKSB7XG4gICAgdGhpcy5fYWxsVGhlbWUgPSB2YWx1ZVxuICAgIHRoaXMuYWxsVGhlbWUkLm5leHQodGhpcy5fYWxsVGhlbWUpXG4gIH1cbiAgZ2V0IGFsbFRoZW1lKCkge1xuICAgIHJldHVybiB0aGlzLl9hbGxUaGVtZVxuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChWVFNfVEhFTUVfQ09ORklHKSBwcml2YXRlIGNvbmZpZzogVnRzVGhlbWVDb25maWcsXG4gICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudDogRG9jdW1lbnQsIFxuICAgIHByaXZhdGUgc3RvcmFnZTogVnRzVGhlbWVTdG9yYWdlU2VydmljZSkge1xuICAgIHRoaXMuaW5pdCgpXG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLnRoZW1lJC5jb21wbGV0ZSgpXG4gICAgdGhpcy5hbGxUaGVtZSQuY29tcGxldGUoKVxuICB9XG5cbiAgc2V0VGhlbWUodGhlbWU6IFZ0c1RoZW1lKSB7XG4gICAgaWYgKHRoaXMuYWxsVGhlbWUuZmlsdGVyKGkgPT4gaS50aGVtZSA9PT0gdGhlbWUpLmxlbmd0aCkge1xuICAgICAgdGhpcy5fdGhlbWUgPSB0aGVtZVxuICAgICAgdGhpcy5sb2FkVGhlbWUoKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBmaW5kIHRoZW1lICR7dGhlbWV9IWApXG4gICAgfVxuICB9XG5cbiAgbG9hZFRoZW1lKCkge1xuICAgIGlmICghdGhpcy5kb2N1bWVudClcbiAgICAgIHJldHVyblxuICAgIGNvbnN0IHVybCA9IHRoaXMuX2FsbFRoZW1lLmZpbHRlcihpID0+IGkudGhlbWUgPT09IHRoaXMuX3RoZW1lKT8uWzBdPy51cmxcbiAgICBpZiAoIXVybClcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGZpbmQgdGhlbWUgJHt0aGlzLl90aGVtZX0hYClcbiAgICBjb25zdCBzY3JpcHQgPSB0aGlzLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTtcbiAgICBzY3JpcHQudHlwZSA9ICd0ZXh0L2Nzcyc7XG4gICAgc2NyaXB0LnJlbCA9ICdzdHlsZXNoZWV0JztcbiAgICBzY3JpcHQuaWQgPSBgdnRzLXRoZW1lLSR7dGhpcy5fdGhlbWV9YDtcbiAgICBzY3JpcHQuaHJlZiA9IGAke3VybH1gO1xuICAgIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAvLyBFbWl0IG5ldyB0aGVtZSBsb2FkZWRcbiAgICAgIHRoaXMudGhlbWUgPSB0aGlzLl90aGVtZVxuICAgICAgdGhpcy5zdG9yYWdlLnNldE9iamVjdChUSEVNRV9LRVksIHRoaXMuX3RoZW1lKVxuICAgICAgdGhpcy5kb2N1bWVudC5ib2R5LnNldEF0dHJpYnV0ZSgndnRzLXRoZW1lJywgdGhpcy5fdGhlbWUhKVxuICAgICAgdGhpcy5fYWxsVGhlbWUubWFwKGkgPT4gaS50aGVtZSkuZmlsdGVyKGkgPT4gaSAhPT0gdGhpcy5fdGhlbWUpLmZvckVhY2goKGkpID0+IHtcbiAgICAgICAgY29uc3QgZG9tID0gdGhpcy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChgdnRzLXRoZW1lLSR7aX1gKVxuICAgICAgICBpZiAoZG9tKVxuICAgICAgICAgIGRvbS5yZW1vdmUoKVxuICAgICAgfSlcbiAgICB9O1xuICAgIHRoaXMuZG9jdW1lbnQuYm9keS5hcHBlbmQoc2NyaXB0KVxuICB9XG5cbiAgaW5pdCgpIHtcbiAgICBjb25zdCB2YWxpZDogc3RyaW5nW10gPSBbXVxuICAgIGNvbnN0IHRoZW1lczogVnRzVGhlbWVJdGVtW10gPSB0aGlzLmNvbmZpZy50aGVtZXMuZmlsdGVyKGkgPT4ge1xuICAgICAgaWYgKHZhbGlkLmluY2x1ZGVzKGkudGhlbWUpKVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIGlmICghIWkudXJsKSB7XG4gICAgICAgIHZhbGlkLnB1c2goaS50aGVtZSlcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH0pXG4gICAgaWYgKCF0aGVtZXMubGVuZ3RoKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdGhlbWUgcHJvdmlkZWQgb3IgaW52YWxpZCBkYXRhIHdhcyBwcm92aWRlZCFcIilcbiAgICB0aGlzLmFsbFRoZW1lID0gdGhlbWVzXG4gICAgY29uc3QgY2FjaGUgPSB0aGlzLnN0b3JhZ2UuZ2V0T2JqZWN0PFZ0c1RoZW1lPihUSEVNRV9LRVkpXG4gICAgdGhpcy5fdGhlbWUgPSB0aGVtZXMuc29tZShpID0+IGkudGhlbWUgPT09IGNhY2hlKSA/IGNhY2hlIDogKHRoaXMuY29uZmlnLmRlZmF1bHRUaGVtZSB8fCB0aGVtZXNbMF0udGhlbWUpXG4gICAgdGhpcy5sb2FkVGhlbWUoKVxuICB9XG59XG4iXX0=